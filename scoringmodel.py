# ----- Primärwaffen: Assault Rifles (AR) -----
ar_data = {
    "M4A1": {
        "base": 8,
        "attachments": {
            "Grenade Launcher": 2,
            "Red Dot Sight": 0,
            "Silencer": 1,
            "ACOG Scope": -3,
            "FMJ": 2,
            "Shotgun": 0,
            "Holographic Sight": -1,
            "Heartbeat Sensor": 3,
            "Thermal Scope": -2,
            "Extended Mags": 1
        }
    },
    "FAMAS": {
        "base": 7,
        "attachments": {
            "Grenade Launcher": 2,
            "Red Dot Sight": 1,
            "Silencer": 1,
            "ACOG Scope": -2,
            "FMJ": 2,
            "Shotgun": 0,
            "Holographic Sight": 1,
            "Heartbeat Sensor": 3,
            "Thermal Scope": -2,
            "Extended Mags": 1
        }
    },
    "SCAR-H": {
        "base": 10,
        "attachments": {
            "Grenade Launcher": 2,
            "Red Dot Sight": 0,
            "Silencer": 1,
            "ACOG Scope": -3,
            "FMJ": 2,
            "Shotgun": 0,
            "Holographic Sight": -1,
            "Heartbeat Sensor": 3,
            "Thermal Scope": -2,
            "Extended Mags": 1
        }
    },
    "TAR-21": {
        "base": 7,
        "attachments": {
            "Grenade Launcher": 2,
            "Red Dot Sight": 0,
            "Silencer": 1,
            "ACOG Scope": -3,
            "FMJ": 2,
            "Shotgun": 0,
            "Holographic Sight": -1,
            "Heartbeat Sensor": 3,
            "Thermal Scope": -2,
            "Extended Mags": 1
        }
    },
    "FAL": {
        "base": 6,
        "attachments": {
            "Grenade Launcher": 2,
            "Red Dot Sight": 1,
            "Silencer": 1,
            "ACOG Scope": -2,
            "FMJ": 2,
            "Shotgun": 0,
            "Holographic Sight": 1,
            "Heartbeat Sensor": 3,
            "Thermal Scope": -2,
            "Extended Mags": 1
        }
    },
    "M16A4": {
        "base": 7,
        "attachments": {
            "Grenade Launcher": 2,
            "Red Dot Sight": 1,
            "Silencer": 1,
            "ACOG Scope": -2,
            "FMJ": 2,
            "Shotgun": 0,
            "Holographic Sight": 1,
            "Heartbeat Sensor": 3,
            "Thermal Scope": -2,
            "Extended Mags": 1
        }
    },
    "ACR": {
        "base": 10,
        "attachments": {
            "Grenade Launcher": 2,
            "Red Dot Sight": 0,
            "Silencer": 1,
            "ACOG Scope": -3,
            "FMJ": 2,
            "Shotgun": 0,
            "Holographic Sight": -1,
            "Heartbeat Sensor": 3,
            "Thermal Scope": -2,
            "Extended Mags": 1
        }
    },
    "F2000": {
        "base": 5,
        "attachments": {
            "Grenade Launcher": 2,
            "Red Dot Sight": -1,
            "Silencer": 1,
            "ACOG Scope": -3,
            "FMJ": 2,
            "Shotgun": 0,
            "Holographic Sight": 1,
            "Heartbeat Sensor": 3,
            "Thermal Scope": -2,
            "Extended Mags": 1
        }
    },
    "AK-47": {
        "base": 8,
        "attachments": {
            "Grenade Launcher": 2,
            "Red Dot Sight": 1,
            "Silencer": 1,
            "ACOG Scope": -3,
            "FMJ": 2,
            "Shotgun": 0,
            "Holographic Sight": 1,
            "Heartbeat Sensor": 3,
            "Thermal Scope": -2,
            "Extended Mags": 1
        }
    }
}

# ----- Primärwaffen: SMGs (als MGs) -----
smg_data = {
    "MP5K": {
        "base": 7,
        "attachments": {
            "Rapid Fire": -2,
            "Red Dot Sight": 0,
            "Silencer": 1,
            "ACOG Scope": -3,
            "FMJ": 2,
            "Akimbo": -5,
            "Holographic Sight": -1,
            "Thermal Scope": -3,
            "Extended Mags": 1
        }
    },
    "UMP45": {
        "base": 9,
        "attachments": {
            "Rapid Fire": -1,
            "Red Dot Sight": 0,
            "Silencer": 1,
            "ACOG Scope": -3,
            "FMJ": 2,
            "Akimbo": -5,
            "Holographic Sight": -1,
            "Thermal Scope": -3,
            "Extended Mags": 1
        }
    },
    "Vector": {
        "base": 6,
        "attachments": {
            "Rapid Fire": -1,
            "Red Dot Sight": 0,
            "Silencer": 1,
            "ACOG Scope": -3,
            "FMJ": 2,
            "Akimbo": -5,
            "Holographic Sight": -1,
            "Thermal Scope": -3,
            "Extended Mags": 1
        }
    },
    "P90": {
        "base": 8,
        "attachments": {
            "Rapid Fire": -1,
            "Red Dot Sight": 0,
            "Silencer": 1,
            "ACOG Scope": -3,
            "FMJ": 2,
            "Akimbo": -5,
            "Holographic Sight": -1,
            "Thermal Scope": -3,
            "Extended Mags": 1
        }
    },
    "Mini-Uzi": {
        "base": 8,
        "attachments": {
            "Rapid Fire": -1,
            "Red Dot Sight": 0,
            "Silencer": 1,
            "ACOG Scope": -3,
            "FMJ": 2,
            "Akimbo": -5,
            "Holographic Sight": -1,
            "Thermal Scope": -3,
            "Extended Mags": 1
        }
    },
}

# ----- Primärwaffen: LMGs -----
lmg_data = {
    "L86 LSW": {
        "base": 6,
        "attachments": {
            "Grip": 2,
            "Red Dot Sight": 1,
            "Silencer": 1,
            "ACOG Scope": -3,
            "FMJ": 2,
            "Holographic Sight": 1,
            "Heartbeat Sensor": 3,
            "Thermal Scope": -2,
            "Extended Mags": 1
        }
    },
    "RPD": {
        "base": 8,
        "attachments": {
            "Grip": 2,
            "Red Dot Sight": 0,
            "Silencer": 1,
            "ACOG Scope": -3,
            "FMJ": 2,
            "Holographic Sight": 0,
            "Heartbeat Sensor": 3,
            "Thermal Scope": -2,
            "Extended Mags": 0
        }
    },
    "MG4": {
        "base": 5,
        "attachments": {
            "Grip": 2,
            "Red Dot Sight": 1,
            "Silencer": 1,
            "ACOG Scope": -3,
            "FMJ": 2,
            "Holographic Sight": 1,
            "Heartbeat Sensor": 3,
            "Thermal Scope": -2,
            "Extended Mags": 0
        }
    },
    "AUG HBAR": {
        "base": 8,
        "attachments": {
            "Grip": 2,
            "Red Dot Sight": 0,
            "Silencer": 1,
            "ACOG Scope": -3,
            "FMJ": 2,
            "Holographic Sight": 0,
            "Heartbeat Sensor": 3,
            "Thermal Scope": -2,
            "Extended Mags": 1
        }
    },
    "M240": {
        "base": 5,
        "attachments": {
            "Grip": 2,
            "Red Dot Sight": 1,
            "Silencer": 1,
            "ACOG Scope": -3,
            "FMJ": 2,
            "Holographic Sight": 1,
            "Heartbeat Sensor": 3,
            "Thermal Scope": -2,
            "Extended Mags": 0
        }
    },
}

# ----- Primärwaffen: Sniper -----
sniper_data = {
    "Intervention": {
        "base": 3,
        "attachments": {
            "Silencer": -2,
            "ACOG Scope": -3,
            "FMJ": 1,
            "Heartbeat Sensor": 3,
            "Thermal Scope": -1,
            "Extended Mags": 1
        }
    },
    "Barrett .50cal": {
        "base": 3,
        "attachments": {
            "Silencer": -2,
            "ACOG Scope": -3,
            "FMJ": 1,
            "Heartbeat Sensor": 3,
            "Thermal Scope": -1,
            "Extended Mags": 1
        }
    },
    "WA2000": {
        "base": 7,
        "attachments": {
            "Silencer": 1,
            "ACOG Scope": -3,
            "FMJ": 1,
            "Heartbeat Sensor": 3,
            "Thermal Scope": -1,
            "Extended Mags": 1
        }
    },
    "M21 EBR": {
        "base": 7,
        "attachments": {
            "Silencer": 1,
            "ACOG Scope": -3,
            "FMJ": 1,
            "Heartbeat Sensor": 3,
            "Thermal Scope": -1,
            "Extended Mags": 1
        }
    },
}

# ----- Primärwaffen: Riot Shield -----
riot_shield_data = {
    "Riot Shield": {
        "base": 1,
        "attachments": {}  # Keine Attachments
    }
}

# ----- Sekundärwaffen: Pistols -----
pistol_secondary_data = {
    "USP .45": {
        "base": 3,
        "attachments": {
            "FMJ": 2,
            "Silencer": 1,
            "Akimbo": 1,
            "Tac-Knife": -1,
            "Extended Mags": 0
        }
    },
    ".44 MAGNUM": {
        "base": 4,
        "attachments": {
            "FMJ": 2,
            "Akimbo": 3,
            "Tac-Knife": 0,
        }
    },
    "M9": {
        "base": 4,
        "attachments": {
            "FMJ": 2,
            "Silencer": 1,
            "Akimbo": 1,
            "Tac-Knife": -1,
            "Extended Mags": 0
        }
    },
    "DESERT EAGLE": {
        "base": 2,
        "attachments": {
            "FMJ": 2,
            "Akimbo": 2,
            "Tac-Knife": 0,
            "Extended Mags": 0
        }
    },
}

# ----- Sekundärwaffen: MPs -----
mp_secondary_data = {
    "PP2000": {
        "base": 4,
        "attachments": {
            "Red Dot Sight": 1,
            "Silencer": 1,
            "FMJ": 2,
            "Akimbo": -2,
            "Holographic Sight": 0,
            "Extended Mags": 1
        }
    },
    "G18": {
        "base": 3,
        "attachments": {
            "Red Dot Sight": 1,
            "Silencer": 1,
            "FMJ": 2,
            "Akimbo": 3,
            "Holographic Sight": 0,
            "Extended Mags": 1
        }
    },
    "M93 Raffica": {
        "base": 4,
        "attachments": {
            "Red Dot Sight": 1,
            "Silencer": 1,
            "FMJ": 2,
            "Akimbo": -2,
            "Holographic Sight": 0,
            "Extended Mags": 1
        }
    },
    "TMP": {
        "base": 5,
        "attachments": {
            "Red Dot Sight": 1,
            "Silencer": 1,
            "FMJ": 2,
            "Akimbo": -2,
            "Holographic Sight": 0,
            "Extended Mags": 1,
            "Thermal Scope": -2  # Falls gewünscht, kannst du hier auch anpassen
        }
    }
}

# ----- Sekundärwaffen: Shotguns -----
shotgun_secondary_data = {
    "SPAS-12": {
        "base": 5,
        "attachments": {
            "Red Dot Sight": 0,
            "Silencer": 0,
            "Grip": 2,
            "FMJ": 1,
            "Holographic Sight": 0,
            "Extended Mags": 1,
        }
    },
    "AA-12": {
        "base": 3,
        "attachments": {
            "Red Dot Sight": 0,
            "Silencer": -1,
            "Grip": 2,
            "FMJ": 1,
            "Holographic Sight": 0,
            "Extended Mags": 1,
        }
    },
    "STRIKER": {
        "base": 3,
        "attachments": {
            "Red Dot Sight": 0,
            "Silencer": -1,
            "Grip": 2,
            "FMJ": 1,
            "Holographic Sight": 0,
            "Extended Mags": 0,
        }
    },
    "RANGER": {
        "base": 2,
        "attachments": {
            "Akimbo": 2,
            "FMJ": 1
        }  # Keine oder wenig Attachments
    },
    "M1014": {
        "base": 3,
        "attachments": {
            "Red Dot Sight": 0,
            "Silencer": -1,
            "Grip": 2,
            "FMJ": 1,
            "Holographic Sight": 0,
            "Extended Mags": 1,
        }
    },
    "MODEL 1887": {
        "base": 3,
        "attachments": {
            "Akimbo": 2,
            "FMJ": 1
        }
    }
}

# ----- Sekundärwaffen: Launcher -----
launcher_secondary_data = {
    "AT4-HS": {
        "base": 2,
        "attachments": {}
    },
    "THUMPER": {
        "base": 3,
        "attachments": {}
    },
    "STINGER": {
        "base": 1,
        "attachments": {}
    },
    "JAVELIN": {
        "base": 1,
        "attachments": {}
    },
    "RPG-7": {
        "base": 2,
        "attachments": {}
    }
}

# ----- Perk-Modifikatoren -----
# Für AR
ar_perk_modifiers = {
    "Marathon": 2,
    "Sleight of Hand": 3,
    "Scavenger": 1,
    "Bling": 0,
    "Stopping Power": 3,
    "Lightweight": 1,
    "Hardline": 1,
    "Cold-Blooded": 1,
    "Danger Close": 1,
    "Commando": 1,
    "Ninja": 3,
    "SitRep": 1,
    "Steady Aim": 1,
    "Scrambler": -3,
    "Last Stand": 1
}
# Für SMGs (MPs)
smg_perk_modifiers = {
    "Marathon": 3,
    "Sleight of Hand": 2,
    "Scavenger": 1,
    "Bling": 0,
    "Stopping Power": 3,
    "Lightweight": 2,
    "Hardline": 1,
    "Cold-Blooded": 1,
    "Danger Close": 1,
    "Commando": 1,
    "Ninja": 3,
    "SitRep": 1,
    "Steady Aim": 1,
    "Scrambler": -3,
    "Last Stand": 1
}
# Für LMGs
lmg_perk_modifiers = {
    "Marathon": 2,
    "Sleight of Hand": 3,
    "Scavenger": 1,
    "Bling": 0,
    "Stopping Power": 3,
    "Lightweight": 2,
    "Hardline": 1,
    "Cold-Blooded": 1,
    "Danger Close": 1,
    "Commando": 1,
    "Ninja": 3,
    "SitRep": 1,
    "Steady Aim": 1,
    "Scrambler": -3,
    "Last Stand": 1
}
# Für Sniper
sniper_perk_modifiers = {
    "Marathon": 2,
    "Sleight of Hand": 3,
    "Scavenger": 1,
    "Bling": 0,
    "Stopping Power": 5,   # Höherer Bonus für Sniper
    "Lightweight": 1,
    "Hardline": 1,
    "Cold-Blooded": 1,
    "Danger Close": 1,
    "Commando": 1,
    "Ninja": 3,
    "SitRep": 1,
    "Steady Aim": 2,
    "Scrambler": -3,
    "Last Stand": 1
}
# Für Riot Shield
riot_shield_perk_modifiers = {
    "Marathon": 2,
    "Sleight of Hand": 1,
    "Scavenger": 1,
    "Bling": 0,
    "Stopping Power": 1,
    "Lightweight": 2,
    "Hardline": 1,
    "Cold-Blooded": 1,
    "Danger Close": 1,
    "Commando": 2,
    "Ninja": 2,
    "SitRep": 1,
    "Steady Aim": 1,
    "Scrambler": -3,
    "Last Stand": 1
}

# ----- Equipment und Special Grenade -----
equipment_scores = {
    "Frag": 3,
    "Semtex": 3,
    "Throwing Knife": 1,
    "Blast Shield": 0,
    "Claymore": 3,
    "C4": 2,
}

special_grenade_scores = {
    "Flash Grenade": 2,
    "Stun Grenade": 3,
    "Smoke Grenade": 1,
}

# ----- Hilfsfunktionen für Waffen -----
def get_weapon_data(weapon_name: str):
    if weapon_name in ar_data:
        return ar_data[weapon_name]
    elif weapon_name in smg_data:
        return smg_data[weapon_name]
    elif weapon_name in lmg_data:
        return lmg_data[weapon_name]
    elif weapon_name in sniper_data:
        return sniper_data[weapon_name]
    elif weapon_name in riot_shield_data:
        return riot_shield_data[weapon_name]
    else:
        return None

def get_secondary_weapon_data(weapon_name: str):
    if weapon_name in mp_secondary_data:
        return mp_secondary_data[weapon_name]
    elif weapon_name in shotgun_secondary_data:
        return shotgun_secondary_data[weapon_name]
    elif weapon_name in pistol_secondary_data:
        return pistol_secondary_data[weapon_name]
    elif weapon_name in launcher_secondary_data:
        return launcher_secondary_data[weapon_name]
    else:
        return None

def get_primary_category(weapon_name: str) -> str:
    if weapon_name in ar_data:
        return "AR"
    elif weapon_name in smg_data:
        return "SMG"
    elif weapon_name in lmg_data:
        return "LMG"
    elif weapon_name in sniper_data:
        return "Sniper"
    elif weapon_name in riot_shield_data:
        return "Riot Shield"
    else:
        return "Unknown"
    

    # ----- Score-Berechnung -----
def calculate_class_score(class_data: dict) -> int:
    total_score = 0

    # ----- Primärwaffe auswerten -----
    primary_text = class_data.get("primary", "")
    if primary_text:
        # Erwartetes Format: "Waffe with Attachment1 & Attachment2" oder nur "Waffe"
        if " with " in primary_text:
            weapon_name, attachments_text = primary_text.split(" with ", 1)
            attachments = [att.strip() for att in attachments_text.split(" & ")]
        else:
            weapon_name = primary_text.strip()
            attachments = []
        weapon_info = get_weapon_data(weapon_name)
        if weapon_info:
            base = weapon_info.get("base", 0)
            total_score += base
            print(f"DEBUG: Primärwaffe: {weapon_name} Basiswert: {base}")
            for att in attachments:
                att_score = weapon_info.get("attachments", {}).get(att, 0)
                total_score += att_score
                print(f"DEBUG: Attachment: {att} Score: {att_score}")
        else:
            print(f"DEBUG: Keine Daten für Primärwaffe: {weapon_name}")
    
    # ----- Sekundärwaffe auswerten -----
    secondary_text = class_data.get("secondary", "")
    if secondary_text:
        if " with " in secondary_text:
            sec_weapon, sec_attachments_text = secondary_text.split(" with ", 1)
            sec_attachments = [att.strip() for att in sec_attachments_text.split(" & ")]
        else:
            sec_weapon = secondary_text.strip()
            sec_attachments = []
        sec_info = get_secondary_weapon_data(sec_weapon)
        if sec_info:
            sec_base = sec_info.get("base", 0)
            total_score += sec_base
            print(f"DEBUG: Sekundärwaffe: {sec_weapon} Basiswert: {sec_base}")
            for att in sec_attachments:
                sec_att_score = sec_info.get("attachments", {}).get(att, 0)
                total_score += sec_att_score
                print(f"DEBUG: Sekundär Attachment: {att} Score: {sec_att_score}")
        else:
            print(f"DEBUG: Keine Daten für Sekundärwaffe: {sec_weapon}")
    
    # ----- Equipment auswerten -----
    equipment = class_data.get("equipment", "")
    eq_score = equipment_scores.get(equipment, 0)
    total_score += eq_score
    print(f"DEBUG: Equipment: {equipment} Score: {eq_score}")
    
    # ----- Special Grenade auswerten -----
    special_grenade = class_data.get("special_grenade", "")
    grenade_score = special_grenade_scores.get(special_grenade, 0)
    total_score += grenade_score
    print(f"DEBUG: Special Grenade: {special_grenade} Score: {grenade_score}")
    
    # ----- Perks auswerten -----
    # Zuerst ermitteln, zu welcher Kategorie die primäre Waffe gehört:
    if primary_text:
        if " with " in primary_text:
            weapon_name = primary_text.split(" with ")[0].strip()
        else:
            weapon_name = primary_text.strip()
        category = get_primary_category(weapon_name)
    else:
        category = "Unknown"
    print(f"DEBUG: Primärwaffe Kategorie: {category}")

    # Wähle den passenden Perk-Modifikator-Dictionary:
    if category == "AR":
        perk_dict = ar_perk_modifiers
    elif category == "SMG":
        perk_dict = smg_perk_modifiers
    elif category == "LMG":
        perk_dict = lmg_perk_modifiers
    elif category == "Sniper":
        perk_dict = sniper_perk_modifiers
    elif category == "Riot Shield":
        perk_dict = riot_shield_perk_modifiers
    else:
        perk_dict = {}  # Fallback

    for perk_key in ["perk1", "perk2", "perk3"]:
        p = class_data.get(perk_key, "")
        perk_score = perk_dict.get(p, 0)
        total_score += perk_score
        print(f"DEBUG: {perk_key}: {p} Score: {perk_score}")
    
    print(f"DEBUG: Gesamter Score: {total_score}")
    return total_score
